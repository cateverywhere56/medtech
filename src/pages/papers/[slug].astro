---
/**
 * Page dÃ©tail : on gÃ©nÃ¨re toutes les routes /papers/[slug] Ã  partir des MD.
 */
export async function getStaticPaths() {
  const modules = import.meta.glob('../../content/papers/*.md', { eager: true });

  return Object.values(modules)
    .map((m: any) => {
      const fm = m.frontmatter || {};
      const permalink = fm.permalink || '';
      if (!permalink.startsWith('/papers/')) return null;

      const slug = permalink.replace(/^\/papers\//, '');
      return { params: { slug }, props: { data: fm, Content: m.Content } };
    })
    .filter(Boolean) as any[];
}

const { data, Content } = Astro.props as { data: any; Content: any };
---
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>{data.title} â€” ActualitÃ©s France</title>
    <meta name="description" content={data.summary} />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body style="font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 760px; margin: 0 auto; padding: 24px;">
    <header>
      <a href="/" style="text-decoration:none;color:inherit"><h1>ActualitÃ©s â€” France</h1></a>
    </header>

    <article style="margin-top:24px;">
      <h2 style="margin-bottom:4px;">{data.title}</h2>
      <div style="opacity:.7;font-size:14px;">
        PubliÃ© le {new Date(data.date).toLocaleDateString('fr-FR')}
        { (data.tags?.length ? ` Â· ${data.tags.join(', ')}` : '') }
      </div>

      {data.imageUrl && (
        <figure style="margin:16px 0;">
          <img src={data.imageUrl} alt={data.title} style="width:100%;  max-height:520px; object-fit:contain; background:#f6f6f6; border-radius:10px;" />
          {data.imageCredit && (
            <figcaption style="font-size:12px; opacity:.7; margin-top:6px;">
              {data.imageCredit}
            </figcaption>
          )}
        </figure>
      )}

      <section style="margin-top:12px;">
        <h3 style="margin:0 0 8px 0;">Lâ€™essentiel</h3>
        <p style="margin:0; white-space:pre-wrap;">{data.summary}</p>
      </section>

      <hr style="margin:24px 0;" />

      <Content />

      {data.sourceUrl && (
        <p style="margin-top:24px;">
          ðŸ”— Lien source : <a href={data.sourceUrl} target="_blank" rel="noreferrer">{data.sourceUrl}</a>
        </p>
      )}
    </article>

    <footer style="opacity:.6; font-size:12px; margin-top:32px;">
      Â© {new Date().getFullYear()} â€” ActualitÃ©s France
    </footer>
  </body>
</html>
