---
/**
 * Page d’accueil : liste des actus générées (Markdown).
 * Titre + image ouvrent l’article source. Fond #D9D9D9. Logo de la source.
 */
const modules = import.meta.glob('../content/papers/*.md', { eager: true });

const posts = Object.values(modules)
  .map((m) => (m as any).frontmatter)
  .filter((fm: any) => fm && fm.title && fm.sourceUrl)
  .sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime());

function hostOf(url: string) {
  try { return new URL(url).hostname.replace(/^www\./, ''); } catch { return ''; }
}
const brandMap: Record<string, string> = {
  'francetvinfo.fr': 'Franceinfo',
  'france24.com': 'France 24',
  'rfi.fr': 'RFI',
  '20minutes.fr': '20 Minutes',
  'ouest-france.fr': 'Ouest-France',
  'lemonde.fr': 'Le Monde',
};
function brandOf(url: string) {
  const h = hostOf(url);
  return brandMap[h] || h || 'Source';
}
function faviconOf(url: string) {
  const h = hostOf(url);
  return h ? `https://www.google.com/s2/favicons?domain=${h}&sz=64` : '';
}
---
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>News — Medtech</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body style="background:#D9D9D9; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; min-height:100vh;">
    <div style="max-width: 1080px; margin: 0 auto; padding: 24px;">
      <header>
        <h1 style="margin:0 0 8px 0;">News — Medtech</h1>
        <p style="opacity:.7;margin:0;"></p>
      </header>

      {
        posts.length === 0
          ? (
            <p style="margin-top:16px; opacity:.8;">
              Aucune actualité pour l’instant. Relance le workflow et recharge la page.
            </p>
          )
          : (
            <main style="display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); margin-top:24px;">
              {posts.map((p: any) => (
                <a
                  href={p.sourceUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label={`Ouvrir l’article source : ${p.title}`}
                  style="text-decoration:none; color:inherit; background:#fff; border:1px solid #eaeaea; border-radius:14px; padding:16px; display:block; box-shadow:0 1px 2px rgba(0,0,0,.04);"
                >
                  {p.imageUrl && (
                    <img
                      src={p.imageUrl}
                      alt={p.title}
                      loading="lazy"
                      style="display:block; width:100%; height:auto; max-height:260px; object-fit:contain; background:#f6f6f6; border-radius:10px; margin-bottom:10px;"
                    />
                  )}
                  <h3 style="margin:0 0 6px 0; line-height:1.25;">{p.title}</h3>
                  <div style="opacity:.7; font-size: 14px; margin-bottom:8px;">
                    {new Date(p.date).toLocaleDateString('fr-FR')}
                  </div>
                  <p style="margin-top:0; opacity:.9;">{p.summary}</p>

                  <div style="display:flex; align-items:center; gap:8px; margin-top:12px; font-size:13px; opacity:.9;">
                    {faviconOf(p.sourceUrl) && (
                      <img
                        src={faviconOf(p.sourceUrl)}
                        alt=""
                        width="16"
                        height="16"
                        style="border-radius:4px; flex:0 0 16px;"
                      />
                    )}
                    <span>{brandOf(p.sourceUrl)}</span>
                  </div>
                </a>
              ))}
            </main>
          )
      }

      <footer style="opacity:.6; font-size:12px; margin-top:32px;">
        © {new Date().getFullYear()} — Actualités France
      </footer>
    </div>
  </body>
</html>
