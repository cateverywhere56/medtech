---
/** Accueil : Articles (internes) + Actus (externes) */
const articlesMod = import.meta.glob('../content/articles/*.md', { eager: true });
const articles = Object.values(articlesMod)
  .map((m: any) => m.frontmatter)
  .filter((fm: any) => fm && fm.title && fm.permalink)
  .sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime());

const newsMod = import.meta.glob('../content/papers/*.md', { eager: true });
const news = Object.values(newsMod)
  .map((m: any) => m.frontmatter)
  .filter((fm: any) => fm && fm.title && fm.sourceUrl)
  .sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime());

function hostOf(url: string){ try { return new URL(url).hostname.replace(/^www\./,''); } catch { return ''; } }
function faviconOf(url: string){ const h = hostOf(url); return h ? `https://www.google.com/s2/favicons?domain=${h}&sz=64` : ''; }
---
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Tech & IA — Articles & Actus</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      .container{ max-width:1280px; margin:0 auto; padding:24px; }
      .cards{ display:grid; gap:16px; grid-template-columns:1fr; }
      @media (min-width:640px){ .cards{ grid-template-columns: repeat(2, 1fr); } }
      @media (min-width:1024px){ .cards{ grid-template-columns: repeat(4, 1fr); } }
      .card{
        text-decoration:none; color:inherit; background:#fff; border:1px solid #eaeaea;
        border-radius:14px; padding:16px; display:block; box-shadow:0 1px 2px rgba(0,0,0,.04);
      }
      .thumb{ display:block; width:100%; height:auto; max-height:260px; object-fit:contain; background:#f6f6f6; border-radius:10px; margin-bottom:10px; }
      h2.sec{ margin:24px 0 12px 0; }
    </style>
  </head>
  <body style="background:#D9D9D9; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0;">
    <div class="container">
      <header>
        <h1 style="margin:0 0 8px 0;">Tech & IA</h1>
        <p style="opacity:.7;margin:0;">Articles originaux (IA) + Actus agrégées.</p>
      </header>

      <h2 class="sec">Articles</h2>
      {articles.length === 0 ? (
        <p style="opacity:.8;">Aucun article pour l’instant.</p>
      ) : (
        <main class="cards">
          {articles.map((p: any) => (
            <a href={p.permalink} class="card">
              {p.imageUrl && <img src={p.imageUrl} alt={p.title} class="thumb" loading="lazy" />}
              <h3 style="margin:0 0 6px 0; line-height:1.25;">{p.title}</h3>
              <div style="opacity:.7; font-size:14px; margin-bottom:8px;">{new Date(p.date).toLocaleDateString('fr-FR')} · {p.author}</div>
              {p.summary && <p style="margin-top:0; opacity:.9;">{p.summary}</p>}
            </a>
          ))}
        </main>
      )}

      <h2 class="sec">Actus</h2>
      {news.length === 0 ? (
        <p style="opacity:.8;">Aucune actualité pour l’instant.</p>
      ) : (
        <section class="cards">
          {news.map((p: any) => (
            <a href={p.sourceUrl} target="_blank" rel="noopener noreferrer" class="card">
              {p.imageUrl && <img src={p.imageUrl} alt={p.title} class="thumb" loading="lazy" />}
              <h3 style="margin:0 0 6px 0; line-height:1.25;">{p.title}</h3>
              <div style="opacity:.7; font-size:14px; margin-bottom:8px;">{new Date(p.date).toLocaleDateString('fr-FR')}</div>
              {p.summary && <p style="margin-top:0; opacity:.9;">{p.summary}</p>}
              <div style="display:flex;align-items:center;gap:8px;opacity:.9;font-size:13px;margin-top:12px;">
                {p.sourceUrl && faviconOf(p.sourceUrl) && <img src={faviconOf(p.sourceUrl)} width="16" height="16" style="border-radius:4px;" alt="" />}
                <span>{hostOf(p.sourceUrl)}</span>
              </div>
            </a>
          ))}
        </section>
      )}

      <footer style="opacity:.6;font-size:12px;margin-top:32px;">© {new Date().getFullYear()} — Tech & IA</footer>
    </div>
  </body>
</html>
